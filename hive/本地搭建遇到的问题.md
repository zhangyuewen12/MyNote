

# 一、hiveserver2增加了权限控制，需要在hadoop的配置文件中配置 

# [Hive启动hiveserver2报错：Could not open client transport with JDBC Uri解决方案](https://www.cnblogs.com/zyt-bg/p/11470168.html)



```
原因：hiveserver2增加了权限控制，需要在hadoop的配置文件中配置 

# hadoop文件夹下面的core-site.xml中的内容

# 设置访问Hdfs的用户名和用户组
    <property>
        <name>hadoop.proxyuser.zyw.hosts</name>
        <value>*</value>
    </property>
    <property>   
        <name>hadoop.proxyuser.supergroup.groups</name>
        <value>*</value>
    </property>


```



# 二、 hive和Hadoop集成时的jar包版本问题

![image-20220111115144233](/Users/zyw/Library/Application Support/typora-user-images/image-20220111115144233.png)

```
主要是guava.jar的版本问题，用户hadoop中高版本的guava替换掉hive中低版本的guava.jar包
cp /opt/hadoop/share/hadoop/hdfs/lib/guava-27.0-jre.jar /opt/hive/lib && \
    rm /opt/hive/lib/guava-14.0.1.jar
```





# [User is not allowed to impersonate anonymous (state=08S01,code=0) org.apache.hadoop.security.authorize.AuthorizationException](https://stackoverflow.com/questions/52994585/user-is-not-allowed-to-impersonate-anonymous-state-08s01-code-0-org-apache-had)



```
Connecting to jdbc:hive2://localhost:10000
18/10/25 09:45:38 [main]: WARN jdbc.HiveConnection: Failed to connect to localhost:10000
Error: Could not open client transport with JDBC Uri: jdbc:hive2://localhost:10000: Failed to open new session: java.lang.RuntimeException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.authorize.AuthorizationException): User: deco is not allowed to impersonate anonymous (state=08S01,code=0)
```



I ever got this error

> User * is not allowed to impersonate anonymous

That's because by default hive tries to execute operations as the calling user, I add below lines to hive config file conf/hive-site.xml, to ask hive to execute operations as the hiveserver2 process user, then get rid of this error:

```
  <property>
    <name>hive.server2.enable.doAs</name>
    <value>false</value>
    <description>
      Setting this property to true will have HiveServer2 execute
      Hive operations as the user making the calls to it.
    </description>
  </property>
```

[Here is the document](https://cwiki.apache.org/confluence/display/Hive/Setting+Up+HiveServer2#SettingUpHiveServer2-Impersonation):

> Impersonation
>
> By default HiveServer2 performs the query processing as the user who submitted the query. But if the following parameter is set to false, the query will run as the user that the hiveserver2 process runs as.
>
> hive.server2.enable.doAs – Impersonate the connected user, default true.



解决问题：https://stackoverflow.com/questions/52994585/user-is-not-allowed-to-impersonate-anonymous-state-08s01-code-0-org-apache-had



 
