# 一、新增配置文件

\# 配置系统的最大文件描述符

```
sudo vi /Library/LaunchDaemons/limit.maxfiles.plist
```

\# 将下面的内容添加到limit.maxfiles.plist中，wq保存。

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
  <plist version="1.0">
    <dict>
      <key>Label</key>
        <string>limit.maxfiles</string>
      <key>ProgramArguments</key>
        <array>
          <string>launchctl</string>
          <string>limit</string>
          <string>maxfiles</string>
          <string>65535</string>
          <string>65535</string>
        </array>
      <key>RunAtLoad</key>
        <true/>
      <key>ServiceIPC</key>
        <false/>
    </dict>
  </plist>
```

PS.这里我将文件描述符修改为65535，虽然macOS相比linux可以设置的更大，不过这个配置对于做压测已经够了。

 

\# 配置系统的最大进程数

```
sudo vi /Library/LaunchDaemons/limit.maxproc.plist
```

\# 将下面的内容添加到limit.maxproc.plist中，wq保存。

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple/DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
  <plist version="1.0">
    <dict>
      <key>Label</key>
        <string>limit.maxproc</string>
      <key>ProgramArguments</key>
        <array>
          <string>launchctl</string>
          <string>limit</string>
          <string>maxproc</string>
          <string>2048</string>
          <string>2048</string>
        </array>
      <key>RunAtLoad</key>
        <true />
      <key>ServiceIPC</key>
        <false />
    </dict>
  </plist>
```

PS.貌似macOS的最大进程数最大只能配置2500，至于为什么不能像linux一样配置到65535，看资料是因为macOS限制了最大进程数为2500（https://apple.stackexchange.com/questions/368011/how-to-increase-the-max-user-processes-hard-limitmojave/368020）。

macOS Server则是根据内存大小，限制了最大进程数的值（https://support.apple.com/zh-cn/HT3854）

 

------

# 二、 修改文件权限

 \# 修改2个文件的权限

```
chown root:wheel /Library/LaunchDaemons/limit.maxfiles.plist
chown root:wheel /Library/LaunchDaemons/limit.maxproc.plist
```

 

------

# 三、更新配置 

\# 查看更新之前的参数

```
ulimit -a
```

![img](https://www.likecs.com/default/index/img?u=aHR0cHM6Ly9pbWcyMDE4LmNuYmxvZ3MuY29tL2NvbW1vbi85MDEyMDEvMjAyMDAyLzkwMTIwMS0yMDIwMDIyNTAwMDAxMjk5Mi03ODk0MjY5NDYucG5n)

 

\# 更新配置

```
launchctl limit
```

 

\# 重启os

```
sudo reboot
```

 

\# 重启后，查看更新之后的参数

```
ulimit -a
```

![img](https://www.likecs.com/default/index/img?u=aHR0cHM6Ly9pbWcyMDE4LmNuYmxvZ3MuY29tL2NvbW1vbi85MDEyMDEvMjAyMDAyLzkwMTIwMS0yMDIwMDIyNTAwMDI0OTcwNS00Nzk3NDY5OTUucG5n)

 

可以看到，更新后的“open files”和“max user processes”已经修改成了需要设置的值了。