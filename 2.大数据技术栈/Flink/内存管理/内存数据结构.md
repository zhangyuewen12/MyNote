Flink的内存管理像操作系统一样，将内存划分为内存段、内存页等结构

# 内存段

MemorySegment是Flink的内存抽象的最小分配单元。默认情况下，一个MemorySegment对应一个32kb大小的内存块。这个内存块既可以是堆上内存，也可以是堆外内存。

# 内存页

MemorySegment是Flink内存分配的最小单元，对于跨MemorySegment保存的数据。如果需要上层的使用者，需要考虑所有的细节，非常繁琐，所以Flink又抽象了一层，叫作内存页。内存页是MemorySegment之上的数据访问视图，数据读取抽象为DataInputView,数据写入抽象为DataOutputView。

DataInputView

DataOutputView

# Buffer

Task算子处理数据完毕，将结果交给下游的时候，使用的抽象或者说使用的内存对象是Buffer。Buffer接口是网络层面上传输数据和事件的统一抽象，其实现类是NetworkBuffer。1个NetworkBuffer中包含1个MemorySegment.

# Buffer资源池

1. Buffer资源池在Flink中叫作BufferPool。BufferPool用来管理Buffer，包含Buffer的申请、释放、销毁、可用buffer通知等，其实现类是LocalBufferPool，每个Task拥有自己的LocalBufferPool。

2. 每个Taskmanager只有一个networkBufferPool，同一个TaskManager上的所有Task共享networkBufferPool，在TaskManager启动的时候，就会创建networkBufferPool。
3. **networkBufferPool 持有该TaskManager在进行数据传递时所能够使用的所有内存。**所以其除了作为BufferPool的工厂外，还作为Task所需内存段的提供者，每个Task的LocalBufferPool都是从networkBufferPool申请而来的。】]